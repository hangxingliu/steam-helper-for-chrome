(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s;})({1:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error('setTimeout has not been defined');}function defaultClearTimeout(){throw new Error('clearTimeout has not been defined');}(function(){try{if(typeof setTimeout==='function'){cachedSetTimeout=setTimeout;}else{cachedSetTimeout=defaultSetTimout;}}catch(e){cachedSetTimeout=defaultSetTimout;}try{if(typeof clearTimeout==='function'){cachedClearTimeout=clearTimeout;}else{cachedClearTimeout=defaultClearTimeout;}}catch(e){cachedClearTimeout=defaultClearTimeout;}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0);}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0);}try{return cachedSetTimeout(fun,0);}catch(e){try{return cachedSetTimeout.call(null,fun,0);}catch(e){return cachedSetTimeout.call(this,fun,0);}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker);}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker);}try{return cachedClearTimeout(marker);}catch(e){try{return cachedClearTimeout.call(null,marker);}catch(e){return cachedClearTimeout.call(this,marker);}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return;}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue);}else{queueIndex=-1;}if(queue.length){drainQueue();}}function drainQueue(){if(draining){return;}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run();}}queueIndex=-1;len=queue.length;}currentQueue=null;draining=false;runClearTimeout(timeout);}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i];}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue);}};function Item(fun,array){this.fun=fun;this.array=array;}Item.prototype.run=function(){this.fun.apply(null,this.array);};process.title='browser';process.browser=true;process.env={};process.argv=[];process.version='';process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[];};process.binding=function(name){throw new Error('process.binding is not supported');};process.cwd=function(){return'/';};process.chdir=function(dir){throw new Error('process.chdir is not supported');};process.umask=function(){return 0;};},{}],2:[function(require,module,exports){(function(process){'use strict';let{log,error}=require('./utils/logger').init('game-card.js'),{$}=require('./utils/dom'),SteamGameCard=require('./utils/steam_gamecards');main();function main(){let info=SteamGameCard.getGameCardInfoFromURL(location.href);if(!info)return showError(`could not get game card info from URL`);fetch(1);function fetch(page){SteamGameCard.getGameCardMarketInfoHTML(info.id,info.border,page,SteamGameCard.getOwnedCardsInfoInCurrentPage()).then(({html,next})=>{log(`fetch market result page ${page} done! (next: ${next})`);showHTML(html);if(next)process.nextTick(fetch,page+1);}).catch(showError);}}function showError(error){showHTML(`<pre style="margin-left: 20px"><code>
			Error: ${error}
		</code></pre>`);}function showHTML(html=''){const SIGN='chrome_extension_market_items';let container=$('.maincontent').expect(1).get();let firstChild=container.firstChild;let firstChildClass=container.firstChild.className||'';if(firstChildClass.indexOf(SIGN)>=0){firstChild.innerHTML+=html;}else{let div=document.createElement('div');div.className=`${SIGN} badge_row depressed`;div.innerHTML=html;container.insertBefore(div,firstChild);}}}).call(this,require('_process'));},{"./utils/dom":3,"./utils/logger":4,"./utils/steam_gamecards":5,"_process":1}],3:[function(require,module,exports){'use strict';let logger=require('./logger');function $(selector='',base=null){let domArray=(base||document).querySelectorAll(selector);return new DOMQueryResult(selector,domArray);}function DOMQueryResult(selector='',domArray=[]){let thiz=this,_name='';this.name=(name='')=>{_name=name;return thiz;};this.expect=(...num)=>{if(num.length==1)if(domArray.length!=num[0])return error(`expect count is ${num[0]}`);if(num.length==2)if(domArray.length<num[0]||domArray.length>=num[1])return error(`expect count is [${num[0]}, ${num[1]})`);return thiz;};this.get=(offset=0)=>domArray[offset];function error(description=''){description=`Query DOM failed, (`+`${_name?'Name: '+_name+' ':''}Selector: ${selector}, Count: ${domArray.length}) `+description;logger.error(description);throw description;}}function appendDivInElement(element,divInnerHTML=''){let div=document.createElement('div');div.innerHTML=divInnerHTML;element.appendChild(div);return element;}function prependDivInElement(element,divInnerHTML=''){let div=document.createElement('div');div.innerHTML=divInnerHTML;if(element.firstChild)element.insertBefore(div,element.firstChild);else element.appendChild(div);return element;}module.exports={$,appendDivInElement,prependDivInElement};},{"./logger":4}],4:[function(require,module,exports){'use strict';const PREFIX='Steam Helper:';let debugInfos=[];let exportObject={init,log,debugInfo,error};module.exports=exportObject;function log(...p){console.log(PREFIX,...p);}function debugInfo(...p){let info=p.join(' ');debugInfos.push(info);}function error(description='',ex=null){console.error(description,ex?ex.stack||ex:'');}function init(injectScriptName){log(`${injectScriptName} has been injected!`);return exportObject;}},{}],5:[function(require,module,exports){'use strict';function getGameCardInfoFromURL(url=""){let matched=url.match(/gamecards\/(\d+)/);if(!matched)return null;return{id:matched[1],border:url.indexOf('border=1')>0?1:0};}function getGameCardMarketInfoHTML(id='',border=0,page=1,_owned=[]){let owned=_owned.map(it=>({name:normalizeName(it.name),count:it.count}));return new Promise((resolve,reject)=>{let url=`https://steamcommunity.com/market/search/render/?query=&start=${(page-1)*10}`+`&count=10&search_descriptions=0&sort_column=price&sort_dir=desc`+`&appid=753&category_753_Game%5B%5D=tag_app_${id}`+`&category_753_cardborder%5B%5D=tag_cardborder_${border}`;let xhr=new XMLHttpRequest();xhr.open('GET',url);xhr.onload=()=>{if(xhr.readyState!=4||xhr.status!=200)return reject(`xhr.readyState = ${xhr.readyState}; `+`xhr.status = ${xhr.status};`);let r=JSON.parse(xhr.responseText);let doc=document.createElement('div');doc.innerHTML=r.results_html;let html=`<table style="width:100%;">`;let results=doc.querySelectorAll('.market_listing_row_link');for(let dom of results){let thumb=dom.querySelector('.market_listing_item_img');thumb.style.maxWidth='62px';let link=document.createElement('a');link.href=dom.href;link.target='_blank';link.className='btn_grey_grey btn_medium';link.innerHTML='<span>Goto Market</span>';let name=dom.querySelector('.market_listing_item_name').innerHTML;let count=dom.querySelector('.market_listing_num_listings_qty').innerHTML;let price=dom.querySelector('.market_table_value .normal_price').innerHTML;let owned=getOwnedCount(name);let color=owned>0?'white':'#666';html+=`<tr>
					<td style="width:62px">${thumb.outerHTML}</td>
					<td style="color:${color};font-size:1.2em;">
						(${owned}) ${name}
					</td>
					<td style="width:128px">count: ${count}</td>
					<td style="color:${color};width: 128px">price: ${price}</td>
					<td style="width: 128px">${link.outerHTML}</td>
				</tr>`;}html+=`</table>`;return resolve({html,next:r.total_count>r.pagesize});};xhr.onerror=err=>reject(err);xhr.send();});function getOwnedCount(name){name=normalizeName(name);for(let it of owned){let itName=it.name;if(itName==name)return it.count;}return 0;}}function getOwnedCardsInfoInCurrentPage(){let result=[{name:'',count:0}];result.pop();let doms=document.querySelectorAll('.badge_card_set_card.owned');for(let dom of doms){let domText=dom.querySelector('.badge_card_set_text');let countText=domText.querySelector('.badge_card_set_text_qty');let text=domText.innerText,countStr=countText.innerText.trim();let name=text.trim().replace(countStr,'').trim();let count=parseInt(countStr.match(/\d+/)[0]);result.push({name,count});}return result;}function normalizeName(name=''){return name.replace(/\W/g,'').toLowerCase();}module.exports={getGameCardInfoFromURL,getGameCardMarketInfoHTML,getOwnedCardsInfoInCurrentPage};},{}]},{},[2]);